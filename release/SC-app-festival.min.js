"use strict";angular.module("SC-app-festival",[]),angular.module("SC-app-festival").controller("FestivalNavCtrl",["$scope",function(a){a.$on("$stateChangeSuccess",function(){a.navOpen=!1})}]),angular.module("SC-app-festival").run(["$rootScope","festivalFactory","utilitiesFactory",function(a,b,c){b.getFestivalSingle(function(b){b.field_date_start&&b.title||a.$broadcast("event:pageNotFound"),a.festival=b,a.websiteTitle=a.festival.title+" at Southbank Centre",a.websiteDescription=a.festival.field_description.value.replace(/(<([^>]+)>)/gi,""),a.festivalDataLoaded=!0,a.$broadcast("event:festivalDataLoaded")},c.genericHTTPCallbackError),b.getNavigation(function(b){if(b.festivalNav.length>0){for(var c in b)a[c]=b[c];"undefined"!=typeof a.festivalFooter&&"undefined"!=typeof a.festivalFooter.field_component&&a.festivalFooter.field_component.length>0&&a.festivalFooter.field_component.reverse()}else a.$broadcast("event:error")},c.genericHTTPCallbackError),b.getTicketTypes(function(b){angular.forEach(b.list,function(a,c){"Free ticketed"===a.name&&b.list.splice(c,1)}),a.ticketTypes=b,a.ticketingDataLoaded=!0,a.$broadcast("event:ticketingDataLoaded")},c.genericHTTPCallbackError)}]),angular.module("SC-app-festival").factory("festivalFactory",["$http","$rootScope","$window","utilitiesFactory","angularMomentConfig","appConfig",function(a,b,c,d,e,f){return{getFestivalSingle:function(g,h){f.festivalAlias?a.get("/json/api/festival/"+f.festivalAlias).success(function(a){a.field_date_start=d.timestampSecondsToMS(a.field_date_start),a.field_date_end=d.timestampSecondsToMS(a.field_date_end);for(var b=c.moment(a.field_date_start).tz(e.timezone),f=c.moment(a.field_date_end).tz(e.timezone),h=[];!b.isAfter(f);)h.push({day:c.moment(b)}),b=b.add(1,"days");a.festivalDays=h,g(a)}).error(h):(console.error("No Festival has been defined for this app"),b.$broadcast("event:error"))},getNavigation:function(c,d){f.festivalId?a.get("/json/node.json?type=navigation&field_festival="+f.festivalId).success(function(a){if(a.list[0]){var d={festivalNav:a.list[0].field_navigation_link,festivalFooter:a.list[0].field_footer};c(d)}else b.$broadcast("event:error")}).error(d):(console.error("No Festival has been defined for this app"),b.$broadcast("event:error"))},getTicketTypes:function(c,d){f.festivalId?a.get("/json/taxonomy_term.json?vocabulary="+f.ticketingVocabularyId).success(c).error(d):(console.error("No ticketing vocabulary has been defined for this app"),b.$broadcast("event:error"))}}}]);